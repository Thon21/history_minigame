<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ°åœ‹ç­–ï¼šç”Ÿå­˜æŠ‰æ“‡</title>
    <style>
        :root {
            --bg-color: #2c2c2c;
            --panel-color: #f4e1c1; /* ç¾Šçš®ç´™è‰² */
            --text-color: #3e2723;
            --highlight: #d32f2f; /* ç§¦ç´… */
            --btn-color: #5d4037;
            --btn-hover: #795548;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", serif;
            background-color: var(--bg-color);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-image: radial-gradient(#3c3c3c 15%, transparent 16%),
            radial-gradient(#3c3c3c 15%, transparent 16%);
            background-size: 60px 60px;
        }

        .game-container {
            width: 800px;
            background-color: var(--panel-color);
            border: 8px solid #8d6e63;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            padding: 20px;
            position: relative;
        }

        .header {
            border-bottom: 2px solid var(--text-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stats-bar {
            display: flex;
            gap: 20px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .stat {
            background: rgba(0,0,0,0.1);
            padding: 5px 10px;
            border-radius: 5px;
        }

        .stat span { color: var(--highlight); }

        .main-content {
            display: flex;
            gap: 20px;
            height: 400px;
        }

        .log-area {
            flex: 1;
            background: rgba(255,255,255,0.5);
            padding: 10px;
            border-radius: 5px;
            overflow-y: auto;
            font-size: 0.9rem;
            color: #555;
            border: 1px solid #ccc;
        }

        .event-area {
            flex: 2;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .event-title {
            font-size: 1.5rem;
            color: var(--highlight);
            margin: 0 0 10px 0;
            font-weight: bold;
        }

        .event-desc {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
            min-height: 100px;
        }

        .choices {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        button {
            background-color: var(--btn-color);
            color: #fff;
            border: none;
            padding: 15px;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.2s;
            text-align: left;
            position: relative;
        }

        button:hover {
            background-color: var(--btn-hover);
            transform: translateX(5px);
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .tooltip {
            font-size: 0.8rem;
            color: #ddd;
            display: block;
            margin-top: 5px;
        }

        .year-display {
            font-size: 2rem;
            font-weight: bold;
            color: var(--text-color);
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--panel-color);
            padding: 0 20px;
            border: 2px solid #8d6e63;
            border-radius: 20px;
        }

        /* çµå±€ç•«é¢ */
        #ending-screen {
            display: none;
            text-align: center;
        }
        
        #game-screen {
            display: block;
        }

    </style>
</head>
<body>

<div class="game-container">
    <div class="year-display">æˆ°åœ‹ <span id="year">453</span> å¹´</div>

    <!-- éŠæˆ²ä¸»ç•«é¢ -->
    <div id="game-screen">
        <div class="header">
            <div><strong>åœ‹è™Ÿï¼š</strong> é­ (æˆ°åœ‹ä¸ƒé›„ä¹‹ä¸€)</div>
            <div class="stats-bar">
                <div class="stat">ğŸŒ¾ ç³§é£Ÿ: <span id="grain">50</span></div>
                <div class="stat">âš”ï¸ è»åŠ›: <span id="army">30</span></div>
                <div class="stat">âš–ï¸ ç©©å®š: <span id="stability">50</span></div>
            </div>
        </div>

        <div class="main-content">
            <div class="event-area">
                <div>
                    <h2 class="event-title" id="event-title">äº‹ä»¶æ¨™é¡Œ</h2>
                    <p class="event-desc" id="event-desc">äº‹ä»¶æè¿°...</p>
                </div>
                <div class="choices" id="choices-container">
                    <!-- é¸é …æŒ‰éˆ•æœƒåœ¨é€™è£¡ç”Ÿæˆ -->
                </div>
            </div>
            <div class="log-area" id="log-area">
                <p>--- å²å®˜ç´€éŒ„ ---</p>
                <p>ä¸‰å®¶åˆ†æ™‰ï¼Œé­åœ‹æ­£å¼ç«‹åœ‹ã€‚</p>
            </div>
        </div>
    </div>

    <!-- çµå±€ç•«é¢ -->
    <div id="ending-screen">
        <h1 id="end-title" style="color: var(--highlight);">éŠæˆ²çµæŸ</h1>
        <p id="end-desc" style="font-size: 1.2rem;">çµå±€æè¿°</p>
        <button onclick="location.reload()" style="text-align: center; margin-top: 20px;">ğŸ“œ å†ç©ä¸€æ¬¡ï¼Œæ”¹å¯«æ­·å²</button>
    </div>
</div>

<script>
    // éŠæˆ²ç‹€æ…‹
    let state = {
        year: 453, // è¥¿å…ƒå‰453å¹´ï¼ˆä¸‰å®¶åˆ†æ™‰ï¼‰
        grain: 50,    // ç¶“æ¿ŸåŸºç¤
        army: 30,     // è»äº‹åŠ›é‡
        stability: 50, // åœ‹å…§ç©©å®šåº¦ (è²´æ—vså¹³æ°‘)
        turn: 0
    };

    // äº‹ä»¶åº« (åŸºæ–¼å½±ç‰‡å…§å®¹è¨­è¨ˆ)
    const events = [
        {
            id: 1,
            title: "ä¸‰å®¶åˆ†æ™‰",
            desc: "æ™‰åœ‹å¼·å¤§çš„æ™ºä¼¯è¢«æ¶ˆæ»…ï¼ŒéŸ“ã€è¶™ã€é­ä¸‰å®¶ç“œåˆ†äº†æ™‰åœ‹çš„åœŸåœ°ã€‚ä½œç‚ºé­åœ‹çš„åˆä»£åœ‹å›ï¼Œæ‚¨ç¾åœ¨é¢è‡¨æœ€é‡è¦çš„é¸æ“‡ï¼šåœ‹å®¶æœªä¾†çš„ç™¼å±•æ–¹å‘æ˜¯ä»€éº¼ï¼Ÿ",
            options: [
                { text: "ä¼‘é¤Šç”Ÿæ¯ï¼Œç™¼å±•è¾²æ¥­", tooltip: "ç³§é£Ÿ+20ï¼Œè»åŠ›-5", effect: {g:20, a:-5, s:0}, msg: "ç™¾å§“å¾—ä»¥è€•ä½œï¼Œç³§å€‰æ¼¸æ»¿ã€‚" },
                { text: "æ“´å……è»å‚™ï¼Œæº–å‚™å…¼ä½µ", tooltip: "è»åŠ›+20ï¼Œç³§é£Ÿ-10", effect: {g:-10, a:20, s:0}, msg: "è»éšŠæ•´æˆˆå¾…æ—¦ï¼Œé„°åœ‹æ„Ÿåˆ°å¨è„…ã€‚" },
                { text: "ç± çµ¡è²´æ—ï¼Œéå›ºçµ±æ²»", tooltip: "ç©©å®š+20ï¼Œç³§é£Ÿ-10", effect: {g:-10, a:0, s:20}, msg: "èˆŠè²´æ—å‹¢åŠ›å¾—åˆ°å®‰æ’«ï¼Œä½†ä¹ŸåŸ‹ä¸‹éš±æ‚£ã€‚" }
            ]
        },
        {
            id: 2,
            title: "äº•ç”°åˆ¶çš„å´©å£",
            desc: "éš¨è‘—éµçŠç‰›è€•çš„å‡ºç¾ï¼Œæ°‘é–“ç§è‡ªé–‹å¢¾çš„åœŸåœ°ï¼ˆç§ç”°ï¼‰è¶Šä¾†è¶Šå¤šï¼Œå…¬å®¶çš„ã€Œäº•ç”°ã€å»è’å»¢äº†ã€‚åœ‹åº«æ”¶å…¥å¤§æ¸›ï¼Œæ‚¨è©²å¦‚ä½•æ”¹é©ç¨…åˆ¶ï¼Ÿ",
            options: [
                { text: "å¯¦è¡Œã€Œåˆç¨…ç•ã€", tooltip: "æ‰¿èªç§ç”°åˆæ³•ä¸¦å¾µç¨…ã€‚ç³§é£Ÿ+30ï¼Œç©©å®š-10", effect: {g:30, a:0, s:-10}, msg: "ä»¿æ•ˆé­¯åœ‹åˆ¶åº¦ï¼Œåœ‹åº«ç¬é–“å……ç›ˆï¼Œä½†å®ˆèˆŠæ´¾è²´æ—ä¸æ»¿ã€‚" },
                { text: "åš´ç¦ç§ç”°ï¼Œå¼·è¿«æ­¸å…¬", tooltip: "ç©©å®š-30ï¼Œç³§é£Ÿ+5", effect: {g:5, a:0, s:-30}, msg: "ç™¾å§“æ€¨è²è¼‰é“ï¼Œéƒ¨åˆ†è¾²æ°‘é€ƒå¾€é„°åœ‹ã€‚" },
                { text: "ç¶­æŒç¾ç‹€ï¼Œçœéš»çœ¼é–‰éš»çœ¼", tooltip: "ç„¡è®ŠåŒ–", effect: {g:-5, a:0, s:5}, msg: "åœ‹åº«æ—¥ç›Šç©ºè™›ï¼Œåœ‹å®¶ç™¼å±•åœæ»¯ã€‚" }
            ]
        },
        {
            id: 3,
            title: "ç™¾å®¶çˆ­é³´ï¼šæ±‚è³¢è‹¥æ¸´",
            desc: "å„åœ‹éƒ½åœ¨æ‹›æ”¬äººæ‰ã€‚ä»Šæ—¥å®®å¤–ä¾†äº†ä¸‰ä½å­¸è€…ï¼Œåˆ†åˆ¥ä»£è¡¨ä¸åŒçš„æ€æƒ³æµæ´¾ï¼Œæ‚¨æ±ºå®šæ¥è¦‹å“ªä¸€ä½ä¸¦æ¡ç´å…¶æ„è¦‹ï¼Ÿ",
            options: [
                { text: "æ³•å®¶å­¸è€… (å¦‚ææ–¯ã€éŸ“é)", tooltip: "è»åŠ›+20ï¼Œç©©å®š+10ï¼Œç³§é£Ÿ-10", effect: {g:-10, a:20, s:10}, msg: "å¯¦è¡Œåš´åˆ‘å³»æ³•ï¼Œå»¢é™¤ä¸–è¥²ç‰¹æ¬Šï¼Œåœ‹åŠ›å¤§å¢ï¼Œä½†ä¹Ÿè®Šå¾—å†·é…·ã€‚" },
                { text: "å„’å®¶å­¸è€… (å¦‚å­Ÿå­)", tooltip: "ç©©å®š+30ï¼Œç³§é£Ÿ-5", effect: {g:-5, a:0, s:30}, msg: "æ¨è¡Œä»æ”¿ï¼Œæ°‘è²´å›è¼•ï¼Œç™¾å§“æ„›æˆ´æ‚¨ã€‚" },
                { text: "å¢¨å®¶å­¸è€… (å¦‚å¢¨å­)", tooltip: "é˜²ç¦¦åŠ›æå‡ï¼Œç³§é£Ÿ+10", effect: {g:10, a:10, s:5}, msg: "æå€¡å…¼æ„›éæ”»ï¼Œä¸¦å”åŠ©æ”¹è‰¯äº†åŸé˜²å™¨æ¢°ã€‚" }
            ]
        },
        {
            id: 4,
            title: "é„°åœ‹æ”¿è®Šï¼šç”°æ°ä»£é½Š",
            desc: "æ±æ–¹çš„å¤§åœ‹é½Šåœ‹ç™¼ç”ŸåŠ‡è®Šï¼æ¬Šè‡£ç”°å’Œå°‡åœ‹å›é½Šåº·å…¬æµæ”¾åˆ°æµ·é‚Šï¼Œè‡ªå·±åšäº†åœ‹å›ã€‚é€™æ‰“ç ´äº†å‘¨ç¦®çš„å‚³çµ±ã€‚æ‚¨è¦å¦‚ä½•åæ‡‰ï¼Ÿ",
            options: [
                { text: "è¶ç«æ‰“åŠ«ï¼Œæ”»æ‰“é½Šåœ‹", tooltip: "è‹¥è»åŠ›>50å‰‡å‹ï¼Œå¦å‰‡æ•—", effect: "war_qi", msg: "" },
                { text: "æ‰¿èªç”°æ°åœ°ä½ï¼Œå»ºç«‹å¤–äº¤", tooltip: "ç©©å®š+10", effect: {g:0, a:0, s:10}, msg: "é­é½Šå»ºäº¤ï¼Œé‚Šå¢ƒæš«æ™‚å®‰å¯§ã€‚" },
                { text: "è­´è²¬ç”°æ°ï¼Œè™Ÿå¬è«¸ä¾¯", tooltip: "è²æœ›ä¸Šå‡ï¼Œä½†ç„¡å¯¦è³ªæ”¶ç›Š", effect: {g:-5, a:0, s:5}, msg: "ç²å¾—äº†å‘¨å¤©å­çš„å£é ­å˜‰çã€‚" }
            ]
        },
        {
            id: 5,
            title: "æ°´åˆ©èˆˆä¿®",
            desc: "è½èç§¦åœ‹æå†°çˆ¶å­ä¿®å»ºéƒ½æ±Ÿå °ï¼Œä½¿æˆéƒ½å¹³åŸæˆç‚ºå¤©åºœä¹‹åœ‹ã€‚æˆ‘å€‘é­åœ‹æ˜¯å¦ä¹Ÿè¦æŠ•å…¥è³‡æºèˆˆä¿®æ°´åˆ©ï¼ˆå¦‚è¥¿é–€è±¹æ²»æ°´ï¼‰ï¼Ÿ",
            options: [
                { text: "å‚¾åœ‹ä¹‹åŠ›ä¿®æ°´åˆ©", tooltip: "ç³§é£Ÿ-30ï¼Œæœªä¾†ç³§é£Ÿç”¢é‡å¤§å¢", effect: {g:-30, a:0, s:10}, msg: "çŸ­æœŸå…§åœ‹åº«è€—ç›¡ï¼Œä½†ç‚ºè¬ä¸–æ‰“ä¸‹åŸºç¤ã€‚" },
                { text: "ç„¡åŠ›è² æ“”ï¼Œå°ˆæ³¨è»äº‹", tooltip: "è»åŠ›+10", effect: {g:0, a:10, s:0}, msg: "æ”¾æ£„äº†è¾²æ¥­ç™¼å±•çš„æ©Ÿæœƒã€‚" }
            ]
        },
        {
            id: 6,
            title: "ç§¦è»æ±å‡º",
            desc: "ç§¦åœ‹å•†é…è®Šæ³•å¾Œåœ‹åŠ›å¤§å¢ï¼Œè™ç‹¼ä¹‹å¸«é–‹å§‹æ±å‡ºå‡½è°·é—œï¼Œé¦–ç•¶å…¶è¡çš„å°±æ˜¯æˆ‘å€‘é­åœ‹ï¼æ±ºæˆ°æ™‚åˆ»åˆ°äº†ï¼",
            options: [
                { text: "åˆç¸±æŠ—ç§¦ (è¯åˆè¶™ã€éŸ“)", tooltip: "éœ€è¦é«˜å¤–äº¤(ç©©å®š)", effect: "war_final_alliance", msg: "" },
                { text: "èˆ‡ç§¦åœ‹æ±ºä¸€æ­»æˆ°", tooltip: "éœ€è¦æ¥µé«˜è»åŠ›", effect: "war_final_solo", msg: "" },
                { text: "å‰²åœ°æ±‚å’Œ", tooltip: "éŠæˆ²å¤±æ•—", effect: "surrender", msg: "" }
            ]
        }
    ];

    function log(msg) {
        const logArea = document.getElementById('log-area');
        const p = document.createElement('p');
        p.textContent = `[${state.year}å¹´] ${msg}`;
        logArea.prepend(p);
    }

    function updateDisplay() {
        document.getElementById('year').innerText = state.year;
        document.getElementById('grain').innerText = state.grain;
        document.getElementById('army').innerText = state.army;
        document.getElementById('stability').innerText = state.stability;
        
        // é¡è‰²è­¦ç¤º
        document.getElementById('grain').style.color = state.grain < 20 ? 'red' : 'inherit';
        document.getElementById('army').style.color = state.army < 20 ? 'red' : 'inherit';
        document.getElementById('stability').style.color = state.stability < 20 ? 'red' : 'inherit';
    }

    function loadEvent() {
        if (state.turn >= events.length) {
            endGame(true); // å‹åˆ©æˆ–å­˜æ´»
            return;
        }

        const evt = events[state.turn];
        document.getElementById('event-title').innerText = evt.title;
        document.getElementById('event-desc').innerText = evt.desc;
        
        const choicesDiv = document.getElementById('choices-container');
        choicesDiv.innerHTML = '';

        evt.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.innerHTML = `<strong>${opt.text}</strong><span class="tooltip">${opt.tooltip}</span>`;
            btn.onclick = () => handleChoice(opt);
            choicesDiv.appendChild(btn);
        });
    }

    function handleChoice(opt) {
        // è™•ç†ç‰¹æ®Šæ•ˆæœ
        if (opt.effect === "war_qi") {
            if (state.army > 50) {
                state.grain += 20;
                state.army -= 10;
                log("è¶é½Šåœ‹å…§äº‚ï¼Œæˆ‘è»å¤§å‹ï¼Œæ å¥ªäº†ç‰©è³‡ï¼");
            } else {
                state.army -= 20;
                state.stability -= 10;
                log("è»åŠ›ä¸è¶³ï¼Œæ”»é½Šå¤±æ•—ï¼Œæå…µæŠ˜å°‡ã€‚");
            }
        } else if (opt.effect === "war_final_alliance") {
            if (state.stability > 60) {
                endGame("win_alliance");
                return;
            } else {
                endGame("lose_betrayal");
                return;
            }
        } else if (opt.effect === "war_final_solo") {
            if (state.army > 80 && state.grain > 40) {
                endGame("win_hegemony");
                return;
            } else {
                endGame("lose_qin");
                return;
            }
        } else if (opt.effect === "surrender") {
            endGame("lose_surrender");
            return;
        } else {
            // ä¸€èˆ¬æ•¸å€¼è®Šæ›´
            state.grain += opt.effect.g;
            state.army += opt.effect.a;
            state.stability += opt.effect.s;
            log(opt.msg);
        }

        // æª¢æŸ¥æ˜¯å¦Game Over
        if (state.grain <= 0 || state.army <= 0 || state.stability <= 0) {
            endGame("collapse");
            return;
        }

        state.turn++;
        state.year += 20; // æ™‚é–“æµé€
        updateDisplay();
        loadEvent();
    }

    function endGame(type) {
        document.getElementById('game-screen').style.display = 'none';
        document.getElementById('ending-screen').style.display = 'block';
        const title = document.getElementById('end-title');
        const desc = document.getElementById('end-desc');

        if (type === "collapse") {
            title.innerText = "åœ‹å®¶å´©æ½°";
            desc.innerText = "ç”±æ–¼æ²»åœ‹ç„¡æ–¹ï¼ˆæŸé …æ•¸å€¼æ­¸é›¶ï¼‰ï¼Œåœ‹å…§ç™¼ç”Ÿæš´å‹•/é¥‘è’/å…µè®Šï¼Œæ‚¨çš„åœ‹å®¶åœ¨æˆ°åœ‹ä¸ƒé›„çš„çˆ­éœ¸ä¸­è¢«ææ—©æ·˜æ±°äº†ã€‚";
        } else if (type === "win_alliance") {
            title.innerText = "åˆç¸±æŠ—ç§¦æˆåŠŸ";
            desc.innerText = "æ‚¨æ†‘è—‰é«˜è¶…çš„å¤–äº¤æ‰‹è…•ï¼ˆé«˜ç©©å®šåº¦ï¼‰ï¼ŒæˆåŠŸè¯åˆè¶™ã€éŸ“ï¼Œåœ¨å‡½è°·é—œæ“‹ä½äº†ç§¦è»ã€‚é›–ç„¶æ²’æœ‰çµ±ä¸€å¤©ä¸‹ï¼Œä½†é­åœ‹æˆç‚ºäº†å±±æ±å…­åœ‹çš„é ˜è¢–ï¼";
        } else if (type === "lose_betrayal") {
            title.innerText = "ç›Ÿå‹èƒŒå›";
            desc.innerText = "æ‚¨è©¦åœ–åˆç¸±æŠ—ç§¦ï¼Œä½†åœ‹å…§ä¸ç©©ï¼Œç›Ÿå‹è¦‹é¢¨è½‰èˆµã€‚ç§¦è»å„å€‹æ“Šç ´ï¼Œé­åœ‹æ»…äº¡ã€‚";
        } else if (type === "win_hegemony") {
            title.innerText = "æ–°çš„éœ¸ä¸»";
            desc.innerText = "æ†‘è—‰å¼·å¤§çš„è»åŠ›å’Œå……è¶³çš„ç³§è‰ï¼Œæ‚¨æ­£é¢æ“Šæ½°äº†ç§¦è»ï¼æ­·å²è¢«æ”¹å¯«ï¼Œé­åœ‹å–ä»£ç§¦åœ‹çµ±ä¸€äº†å¤©ä¸‹ï¼";
        } else if (type === "lose_qin") {
            title.innerText = "é•·å¹³ä¹‹ç—›";
            desc.innerText = "é›–ç„¶æ‚¨å¥®åŠ›ä¸€æï¼Œä½†ç§¦åœ‹å•†é…è®Šæ³•å¾Œçš„å¯¦åŠ›å¤ªéå¼·å¤§ã€‚é­è»ä¸»åŠ›è¢«æ®²æ»…ï¼Œåœ‹å®¶æ»…äº¡ã€‚";
        } else if (type === "lose_surrender") {
            title.innerText = "è‹Ÿå»¶æ®˜å–˜";
            desc.innerText = "æ‚¨é¸æ“‡å‰²åœ°æ±‚å’Œã€‚é›–ç„¶ä¿ä½äº†æ€§å‘½ï¼Œä½†é­åœ‹å·²æ·ªç‚ºç§¦åœ‹çš„é™„åº¸ï¼Œæœ€çµ‚é›£é€ƒæ»…äº¡çš„å‘½é‹ã€‚";
        }
    }

    // é–‹å§‹éŠæˆ²
    updateDisplay();
    loadEvent();

</script>

</body>
</html>